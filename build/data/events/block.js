define(["animation","input","map"],function(e,t,n){return{animate:function(t,n){(this.data.event.fall||!this.data.onLand)&&this.on.fall.call(this,t,n),this.data.event.move&&this.on.move.call(this,t,n),e.context.drawImage(this.image,this.data.frameData.x,this.data.frameData.y,this.data.frameData.w,this.data.frameData.h,this.data.x-this.data.frameData.cpx,this.data.y-this.data.frameData.cpy,this.data.w,this.data.h),this.on.resetCollisions.call(this)},move:function(e,t){this.data.direction.right===!0&&this.data.blocked.right===!1?this.data.x=this.data.x+this.data.moveSpeed:this.data.direction.left===!0&&this.data.blocked.left===!1&&(this.data.x=this.data.x-this.data.moveSpeed)},fall:function(e,t){this.data.event.fall=!0,this.data.y+=Math.floor(2*this.data.fallRate),this.data.fallRate+=e.world.data.gravity},land:function(e,t){this.data.onLand=!0,this.data.event.fall=!1,this.data.fallRate=0},collideBottom:function(e){this.data.event.fall&&(this.data.y=e.y*32-32,this.on.land.call(this)),this.data.onLand=!0,this.data.blocked.down=!0},collideTop:function(e){this.data.blocked.up=!0},collideRight:function(e){this.data.event.move=!0,this.data.direction.left=!0,this.data.blocked.right=!0},collideLeft:function(e){this.data.event.move=!0,this.data.direction.right=!0,this.data.blocked.left=!0},parseTilePosition:function(){var e=function(e){var t=Math.round(e/32);return t},t=this.animations[this.data.action].speed,n=this.counter,r=Math.floor(n/t);if(r>this.animations[this.data.action].frames.length-1||t===0)r=0,this.counter=0;this.data.frameData=this.animations[this.data.action].frames[r],this.data.tileX=e(this.data.x-this.data.frameData.cpx),this.data.tileY=e(this.data.y-this.data.frameData.cpy)},resetCollisions:function(){this.data.action="idle",this.data.onLand=!1,this.data.direction.left=!1,this.data.direction.right=!1,this.data.blocked.left=!1,this.data.blocked.right=!1,this.data.blocked.up=!1,this.data.blocked.down=!1,this.data.isFlipped&&(e.context.restore(),this.data.isFlipped=!1),this.on.parseTilePosition.call(this)}}})