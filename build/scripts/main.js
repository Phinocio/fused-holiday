define("/data/maps/test.js",[],function(){return{height:12,layers:[{data:[14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14],height:12,name:"background",opacity:1,type:"tilelayer",visible:!0,width:24,x:0,y:0},{data:[15,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,15,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,0,0,0,0,16,7,7,7,7,7,7,7,7,7,7,7,15,1,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,0,0,17,7,1,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,0,0,0,0,13,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,17,7,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,0,15,0,0,4,0,0,0,0,0,0,0,0,0,0,0,3,15,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,15],height:12,name:"floor",opacity:1,type:"tilelayer",visible:!0,width:24,x:0,y:0},{data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],height:12,name:"foreground",opacity:1,type:"tilelayer",visible:!0,width:24,x:0,y:0}],orientation:"orthogonal",properties:{height:"12",name:"test",width:"24"},tileheight:32,tilesets:[{firstgid:1,image:"/images/tiles.png",imageheight:192,imagewidth:192,margin:0,name:"tiles",properties:{},spacing:0,tileheight:32,tileproperties:{0:{group:"wall",name:"wall_left",passable:"false",x:"0",y:"0"},1:{group:"wall",name:"wall_floor",passable:"false",x:"1",y:"0"},10:{group:"ladder",name:"ladder_mid",passable:"true",x:"4",y:"1"},11:{group:"empty",name:"ladder_right",passable:"true",x:"5",y:"1"},12:{group:"wall",name:"wall_bottom_end",passable:"false",x:"0",y:"2"},13:{group:"background",name:"background",passable:"true",x:"1",y:"2"},14:{group:"wall",name:"wall",passable:"false",x:"2",y:"2"},15:{group:"wall",name:"wall_floor_left",passable:"false",x:"3",y:"2"},16:{group:"wall",name:"wall_left_end",passable:"false",x:"4",y:"2"},2:{group:"wall",name:"wall_right",passable:"false",x:"2",y:"0"},3:{group:"door",name:"door_base",passable:"false",x:"3",y:"0"},4:{group:"door",name:"door_top",passable:"false",x:"4",y:"0"},5:{group:"door",name:"door_mid",passable:"false",x:"5",y:"0"},6:{group:"wall",name:"wall_floor_roof",passable:"false",x:"0",y:"1"},7:{group:"wall",name:"wall_right_left",passable:"false",x:"1",y:"1"},8:{group:"wall",name:"wall_roof",passable:"false",x:"2",y:"1"},9:{group:"empty",name:"ladder_left",passable:"true",x:"3",y:"1"}},tilewidth:32,transparentcolor:"#ffffff"}],tilewidth:32,version:1,width:24}}),define("map",["/data/maps/test.js","animation"],function(e,t){return{maps:{test:e},currentMap:null,sheetImage:null,buildMap:function(e){this.currentMap=this.maps[e],this.sheetImage=new Image,this.sheetImage.src=this.currentMap.tilesets[0].image},animate:function(e){var t,n,r,i,s,o,u,a,f=this.currentMap.layers.length;for(n=0;n<f;n++){t=this.currentMap.layers[n],e.setup(t.name),o=t.width,u=t.height;for(i=0;i<u;i++)for(r=0;r<o;r++)s=t.data[o*i+r]-1,s!==-1&&(a=this.currentMap.tilesets[0].tileproperties[s],e.context.drawImage(this.sheetImage,this.currentMap.tileheight*a.x,this.currentMap.tileheight*a.y,this.currentMap.tileheight,this.currentMap.tileheight,this.currentMap.tileheight*r,this.currentMap.tileheight*i,this.currentMap.tileheight,this.currentMap.tileheight))}},collide:function(e,t){var n=[],r=this.currentMap.layers.length;for(l=0;l<r;l++){var i=this.currentMap.layers[l],s=i.width,o=i.data[s*t+e]-1;if(o!==-1){var u=this.currentMap.tilesets[0].tileproperties;n.push(u[o])}}return n}}}),define("physics",["map"],function(e){var t=function(e,t){return e.indexOf(t)>-1},n=function(e){var t=Math.floor(e/32);return t<0&&(t=0),t},r=function(t,r){var i=!1,s=e.currentMap.layers.length;for(l=0;l<s;l++){var o=e.currentMap.layers[l],u=o.width,a=o.data[u*n(r)+n(t)]-1;if(a!==-1){var f=e.currentMap.tilesets[0].tileproperties;f[a].passable==="false"&&(i=f[a])}}return i},i=function(e,t){if(e%32===0)return[n(e)];var r=n(e),i=n(t),s=[];for(var o=r;o<i;o++)s.push(o);return s.push(i),s},s=function(t,n,r){var i=[],s=e.currentMap.layers.length;for(l=0;l<s;l++){var o=e.currentMap.layers[l],u=o.width;for(var a=0;a<t.length;a++){var f=t[a];for(var c=0;c<n.length;c++){var h=n[c],p=o.data[u*h+f]-1,d=e.currentMap.tilesets[0].tileproperties;p===-1?i.push(!1):i.push(d[p].passable==="false")}}}return i};return function(o,u){var a=o.data.physics.checkAgainst,f=o.data.physics.types;if(!(o.data.physics.checkAgainst.length>0))return!1;var l=o.data.x-o.data.frameData.cpx,c=o.data.y-o.data.frameData.cpy,h=l+o.data.w,p=c+o.data.h,d=(l+h)/2,v=(c+p)/2,m=0,g,y,b,w;if(t(a,"map")){m=0,o.data.event.walk&&o.data.direction.left&&(m=o.data.walkSpeed),g=n(l-m)*32,y=n(v)*32,b=g+32,w=y+32;var E=s([n(l-m)],i(c,p));(l+m<=0||E.indexOf(!0)>-1)&&o.on.collideLeft.call(o,{x:n(l+m)}),m=0,o.data.event.walk&&o.data.direction.right&&(m=o.data.walkSpeed),g=n(h+m)*32,y=n(v)*32,b=g+32,w=y+32;var S=s([n(h+m)],i(c,p));(h+m>=e.currentMap.width*32||S.indexOf(!0)>-1)&&o.on.collideRight.call(o,{x:n(h+m)}),m=0,o.data.event.jump&&(m=Math.floor(2*o.data.jumpRate)),g=n(d)*32,y=n(c-m)*32,b=g+32,w=y+32;var x=s(i(l,h),[n(c+m)]);(c+m<=0||x.indexOf(!0)>-1)&&o.on.collideTop.call(o,{y:n(c+m)}),m=0,o.data.event.fall&&(m=Math.floor(2*o.data.fallRate)),g=n(d)*32,y=n(p+m)*32,b=g+32,w=y+32;var T=s(i(l,h),[n(p+m)]);(p+m>=e.currentMap.height*32||T.indexOf(!0)>-1)&&o.on.collideBottom.call(o,{y:n(p+m)})}if(t(a,"entity"))for(var N=0;N<u.length;N++){var C=u[N];if(C.data.uniqueId!==o.data.uniqueId&&t(C.data.physics.types,"entity"))var g=C.data.x-C.data.frameData.cpx,y=C.data.y-C.data.frameData.cpy,b=g+C.data.w,w=y+C.data.h,k=(g+b)/2,L=(y+w)/2}}}),define("animation",["physics","map"],function(e,t){return function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),{canvas:{},context:{},renderList:[],mainLoop:null,startLoop:function(e){return e()},stopLoop:function(e){cancelAnimationFrame(e)},setup:function(e){this.canvas=document.getElementById(e),this.context=this.canvas.getContext("2d"),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},animationLoop:function(t,n){var r=this.renderList.length,i;t.animate(this),this.setup("objects");for(var s=0;s<r;s++){var i=this.renderList[s];i.remove?(i.on.destroy.call(i,null,null),this.renderList.splice(s),r=this.renderList.length,s--):(e(i,this.renderList),i.data.id==="player"?(this.setup("player"),i.on.animate.call(i,n.environment,null),this.context.fillStyle="rgba(0,0,0,0.5)",this.context.fillRect(i.data.x-i.data.frameData.cpx,i.data.y-i.data.frameData.cpy,i.data.w,i.data.h),this.setup("objects")):(i.on.animate.call(i,n.environment,null),this.context.fillStyle="rgba(0,0,0,0.5)",this.context.fillRect(i.data.x-i.data.frameData.cpx,i.data.y-i.data.frameData.cpy,i.data.w,i.data.h)))}}}}),define("input",[],function(){return{keys:{up:!1,down:!1,right:!1,left:!1,space:!1,z:!1,x:!1},listen:function(e,t){document.addEventListener(e,t)},trigger:function(e,t){var n=new CustomEvent(e,{detail:t});document.dispatchEvent(n)},keyDown:function(e,t){e.keyCode===39&&(this.keys.right=!0),e.keyCode===37&&(this.keys.left=!0),e.keyCode===32&&(this.keys.space=!0),e.keyCode===38&&(this.keys.up=!0),e.keyCode===40&&(this.keys.down=!0),e.keyCode===90&&(this.keys.z=!0),e.keyCode===88&&(this.keys.x=!0)},keyUp:function(e,t){e.keyCode===39&&(this.keys.right=!1),e.keyCode===37&&(this.keys.left=!1),e.keyCode===32&&(this.keys.space=!1),e.keyCode===38&&(this.keys.up=!1),e.keyCode===40&&(this.keys.down=!1),e.keyCode===90&&(this.keys.z=!1),e.keyCode===88&&(this.keys.x=!1)}}}),define("entity",["animation"],function(e){return{cloneObject:function(e,t){if(t){var n=[];for(var r=0;r<e.length;r++)typeof e[r]=="object"?n.push(this.cloneObject(e[r],Array.isArray(e[r]))):n.push(e[r])}else{var n={};for(var i in e)typeof e[i]=="object"?n[i]=this.cloneObject(e[i],Array.isArray(e[i])):n[i]=e[i]}return n},inGame:[],master:{characters:{},tiles:{},objects:{},tools:{},environment:{}},make:function(e,t,n,r,i,s){return e[n]=e[n]||{},e[n][i.id]={spriteSheet:t,image:null,counter:0,animations:this.cloneObject(r),data:this.cloneObject(i),on:this.cloneObject(s)},e[n][i.id]},isMoving:function(e){if(e.data.event)for(var t in e.data.event)if(e.data.event[t])return console.log(t),!0;return!1},stop:function(e){if(e.data.event){for(var t in e.data.event)e.data.event[t]=!1;return!0}return!1},clone:function(e){var t=this.cloneObject(e),n=new Image;return n.src=e.spriteSheet,t.image=n,t.data.uniqueId=Math.floor(Math.random()*1e6),t.data.frameData=t.animations[t.data.action].frames[0],t},print:function(e){return parseJSON["to"+e](this.master)},spawn:function(e,t,n){var r=this.clone(e);for(var i in t)r.data[i]=t[i];this.inGame.push(r),n.push(r)},collide:function(t){var n=[],r=t.data.x-t.data.frameData.cpx,i=t.data.y-t.data.frameData.cpy,s=r+t.data.w,o=i+t.data.h,u=(r+s)/2,a=(i+o)/2;for(var f=0;f<e.renderList.length;f++){var l=e.renderList[f],c=l.data.x,h=l.data.y,p=c+l.data.w,d=h+l.data.h,v=(c+p)/2,m=(h+d)/2;e.context.fillRect(r,i,32,32),e.context.fillRect(c,h,l.data.w,l.data.h),r-(t.data.direction.left===!0)<=p&&i<=d&&o>=h&&r-(t.data.direction.left===!0)>=c&&n.push({direction:"left",target:l}),s+(t.data.direction.right===!0)>=c&&i<=d&&o>=h&&s+(t.data.direction.right===!0)<=p&&n.push({direction:"right",target:l}),i-(t.data.event.jump===!0)<=d&&r<=p&&s>=c&&i-(t.data.event.jump===!0)>=h&&n.push({direction:"top",target:l}),o+(t.data.event.fall===!0)>=h&&r<=p&&s>=c&&o+(t.data.event.fall===!0)<=d&&n.push({direction:"bottom",target:l})}return n}}}),define("/data/data/world.js",[],function(){return{id:"world",gravity:.1}}),define("/data/animations/playertest.js",[],function(){return{stand:{speed:0,frames:[{x:3,y:14,w:32,h:37,cpx:16,cpy:19}]},climb:{speed:0,frames:[{x:289,y:10,w:44,h:52,cpx:22,cpy:26}]},walk:{speed:0,frames:[{x:48,y:22,w:47,h:24,cpx:16,cpy:19}]},jump:{speed:0,frames:[{x:119,y:11,w:23,h:41,cpx:16,cpy:20}]},fall:{speed:0,frames:[{x:168,y:10,w:29,h:49,cpx:16,cpy:24}]},land:{speed:0,frames:[{x:219,y:6,w:46,h:58,cpx:16,cpy:20}]}}}),define("/data/data/player.js",[],function(){return{health:100,x:448,y:320,tileX:14,tileY:10,w:32,h:32,id:"player",direction:{up:!1,right:!1,down:!1,left:!1},event:{jump:!1,fall:!0,walk:!1,dash:!1,climb:!1,action:!1,stop:!1},lastDirection:"right",action:"stand",onLand:!1,blocked:{up:!1,down:!1,right:!1,left:!1},jumpRate:-3,jumpForce:-3,fallRate:0,walkSpeed:1,frameData:null,isFlipped:!1,physics:{checkAgainst:["map","entity","bullet"],types:["player","entity"]},oldFrame:{animation:"",index:0}}}),define("/data/events/player.js",["animation","input","map","entity"],function(e,t,n,r){return{walk:function(e,n){if(this.data.event.stop)return this.data.event.stop=!1,!0;if(this.data.event.climb)return!0;t.keys.left||t.keys.right?(this.data.event.walk=!0,this.data.event.stand=!1):(this.data.event.walk=!1,this.data.event.stand=!0);if(t.keys.left&&t.keys.right){if(this.data.direction.right||this.data.direction.left)this.counter=0}else this.data.event.walk&&(t.keys.right===!0&&this.data.blocked.right===!1?this.data.x=this.data.x+this.data.walkSpeed:t.keys.left===!0&&this.data.blocked.left===!1&&(this.data.x=this.data.x-this.data.walkSpeed));t.keys.right===!1&&this.data.direction.right===!0&&(this.counter=0),t.keys.left===!1&&this.data.direction.left===!0&&(this.counter=0)},door:function(e,t){this.data.direction.left?this.data.x=(t.x-1)*32+15:this.data.direction.right&&(this.data.x=(t.x+1)*32+16)},climb:function(e,r){var i=function(e,t){for(var n=0;n<e.length;n++)if(e[n].group===t)return e[n];return!1},s=function(){this.data.fallRate=0,this.data.jumpRate=this.data.jumpForce,this.data.action="climb",this.data.event.jump=!1,this.data.event.fall=!1,this.data.y=this.data.y-1,this.data.onLand=!1,this.counter++,this.data.event.climb=!0},o=function(){this.data.fallRate=0,this.data.jumpRate=this.data.jumpForce,this.data.action="climb",this.data.event.jump=!1,this.data.event.fall=!1,this.data.y=this.data.y+1,this.data.onLand=!1,this.counter++,this.data.event.climb=!0},u=function(){!this.data.onLand&&this.data.event.climb&&(this.data.event.climb=!1,this.data.event.fall=!0)},a,f,l=this.data.tileX,c=this.data.tileY,h=n.collide(l,c),p=n.collide(l,c-1),d=n.collide(l,c+1);t.keys.up===!0?(this.data.event.jump||this.data.event.fall)&&!this.data.event.climb?s.call(this):i(h,"wall")&&i(h,"ladder")&&!i(p,"ladder")?s.call(this):i(h,"ladder")&&i(p,"ladder")?s.call(this):!i(h,"ladder")&&i(d,"ladder")&&this.data.event.climb?s.call(this):!i(h,"ladder")&&!i(p,"ladder")?u.call(this):u.call(this):t.keys.down===!0&&(i(h,"wall")&&i(h,"ladder")&&i(d,"ladder")?o.call(this):!i(h,"ladder")&&i(d,"ladder")?o.call(this):i(h,"ladder")&&i(d,"ladder")?o.call(this):i(h,"ladder")&&!i(d,"ladder")?u.call(this):u.call(this))},parseTilePosition:function(){var e=function(e){var t=Math.round(e/32);return t},t=this.animations[this.data.action].speed,n=this.counter,r=Math.floor(n/t);if(r>this.animations[this.data.action].frames.length-1||t===0)r=0,this.counter=0;this.data.frameData=this.animations[this.data.action].frames[r],this.data.tileX=e(this.data.x-this.data.frameData.cpx),this.data.tileY=e(this.data.y-this.data.frameData.cpy)},action:function(e,t){var r=function(e,t){if(e)for(var n=0;n<e.length;n++){!e[n];if(e[n].group===t)return e[n]}return!1},i,s,o,u,a=this.data.tileX,f=this.data.tileY;return o=n.collide(a,f),u=n.collide(a,f+1),r(o,"door")?this.on.door.call(this,e,{x:a,y:f}):r(o,"ladder")||r(u,"ladder")?this.on.climb.call(this,e,t):this.data.direction.left?(i=n.collide(a,f),s=r(i,"door"),s&&this.on.door.call(this,e,{x:a,y:f})):(a+=1,i=n.collide(a,f),s=r(i,"door"),s&&this.on.door.call(this,e,{x:a,y:f})),t},jump:function(e,n){!t.keys.space||this.data.jumpRate>=0||this.data.event.climb?(this.data.event.jump=!1,this.data.event.fall=!0):(this.data.event.jump===!1,this.data.onLand=!1,this.data.action="jump",this.data.event.jump=!0,this.data.y+=Math.floor(2*this.data.jumpRate),this.data.jumpRate+=e.world.data.gravity)},fall:function(e,t){this.data.action="fall",this.data.event.fall=!0,this.data.event.climb=!1,this.data.event.jump=!1,this.data.y+=Math.floor(2*this.data.fallRate),this.data.fallRate+=e.world.data.gravity},land:function(e,t){this.data.action="land",this.data.onLand=!0,this.data.event.jump=!1,this.data.event.fall=!1,this.data.event.climb=!1,this.data.fallRate=0,this.data.jumpRate=this.data.jumpForce},animate:function(n,r){if(!t.keys.left||!t.keys.right)if(t.keys.left||t.keys.right)t.keys.left&&(this.data.lastDirection="left"),t.keys.right&&(this.data.lastDirection="right"),this.data.action="walk";this.data.direction.left=this.data.lastDirection==="left",this.data.direction.right=this.data.lastDirection==="right",(this.data.event.action||t.keys.up||t.keys.down)&&this.data.event.climb===!1&&this.on.action.call(this,n,r),this.data.event.fall||!this.data.onLand&&!this.data.event.climb&&!this.data.event.jump?this.on.fall.call(this,n,r):this.data.event.jump||t.keys.space?this.on.jump.call(this,n,r):this.data.event.climb&&this.on.climb.call(this,n,r),(this.data.event.walk||t.keys.left||t.keys.right)&&this.on.walk.call(this,n,r),this.animations[this.data.action].speed>0&&this.data.event.climb===!1&&this.counter++;var i=this.animations[this.data.action].speed,s=Math.floor(this.counter/i);if(s>this.animations[this.data.action].frames.length-1||i===0)s=0,this.counter=0;var o=this.data.frameData=this.animations[this.data.action].frames[s];this.data.direction.left===!0?(this.data.isFlipped||(e.context.save(),e.context.scale(-1,1),e.context.translate(-e.canvas.width,0),this.data.isFlipped=!0),e.context.drawImage(this.image,o.x,o.y,o.w,o.h,e.canvas.width-(this.data.x-o.cpx)-o.w,this.data.y-o.cpy,o.w,o.h)):e.context.drawImage(this.image,o.x,o.y,o.w,o.h,this.data.x-o.cpx,this.data.y-o.cpy,o.w,o.h),this.on.resetCollisions.call(this)},collideBottom:function(e){this.data.event.fall&&(this.data.y=e.y*32-13,this.on.land.call(this)),this.data.onLand=!0,this.data.blocked.down=!0},collideTop:function(e){this.data.event.jump&&(this.data.event.jump=!1,this.data.event.fall=!0,this.data.action="fall"),this.data.blocked.up=!0},collideRight:function(e){this.data.action="stand",this.data.event.walk=!1,this.data.event.stand=!0,this.data.blocked.right=!0},collideLeft:function(e){this.data.action="stand",this.data.event.walk=!1,this.data.event.stand=!0,this.data.blocked.left=!0},resetCollisions:function(){this.data.action="stand",this.data.onLand=!1,this.data.blocked.left=!1,this.data.blocked.right=!1,this.data.blocked.up=!1,this.data.blocked.down=!1,this.data.isFlipped&&(e.context.restore(),this.data.isFlipped=!1),this.on.parseTilePosition.call(this)}}}),define("/data/animations/dummy.js",[],function(){return{stand:{speed:0,frames:[{x:4,y:1,w:34,h:39,cpx:18,cpy:19}]},walk:{speed:5,frames:[{x:6,y:44,w:30,h:39,cpx:18,cpy:19},{x:45,y:44,w:32,h:38,cpx:18,cpy:19},{x:86,y:43,w:37,h:39,cpx:18,cpy:19},{x:127,y:44,w:39,h:37,cpx:18,cpy:19},{x:176,y:44,w:32,h:37,cpx:18,cpy:19},{x:221,y:45,w:24,h:36,cpx:18,cpy:19},{x:261,y:44,w:28,h:37,cpx:18,cpy:19},{x:298,y:43,w:34,h:38,cpx:18,cpy:19},{x:340,y:44,w:34,h:38,cpx:18,cpy:19},{x:380,y:45,w:38,h:37,cpx:18,cpy:19},{x:424,y:45,w:34,h:37,cpx:18,cpy:19}]},jump:{speed:0,frames:[{x:424,y:45,w:34,h:37,cpx:18,cpy:19}]},fall:{speed:0,frames:[{x:298,y:43,w:34,h:38,cpx:18,cpy:19}]},land:{speed:0,frames:[{x:86,y:43,w:37,h:39,cpx:18,cpy:19}]}}}),define("/data/data/dummy.js",[],function(){return{health:100,x:480,y:288,w:32,h:32,id:"dummy",direction:{up:!1,right:!1,down:!1,left:!1},event:{jump:!1,fall:!0,walk:!1,dash:!1},frameData:null,jumpRate:-3,jumpForce:-3,fallRate:0,isFlipped:!1,physics:{checkAgainst:["map"],types:["entity"]},oldFrame:{animation:"",index:0}}}),define("/data/events/dummy.js",["animation","input","map"],function(e,t,n){return{walk:function(e,n){var r=this.on.collision.call(this,e,n);if(r.triggers.indexOf("left")>-1||r.triggers.indexOf("right")>-1)n=r.event;return!t.keys.left&&!t.keys.right&&(this.data.event.walk=!1,this.data.event.stand=!0),(!t.keys.left||!t.keys.right)&&this.data.event.walk&&r.triggers.indexOf("left")===-1&&r.triggers.indexOf("right")===-1,t.keys.right===!1&&this.data.direction.right===!0,t.keys.left===!1&&this.data.direction.left===!0,n},dash:function(e,t){return t},stand:function(e,t){return t},jump:function(e,n){n=this.on.walk.call(this,e,n);var r=this.on.collision.call(this,e,n);return r.triggers.indexOf("top")>-1||this.data.jumpRate>=0?(this.data.event.jump=!1,n=r.event,this.on.fall.call(this,e,n)):(this.data.fallRate=0,n.action="jump",this.data.event.jump=!0,this.data.y+=Math.floor(2*this.data.jumpRate),this.data.jumpRate+=e.world.data.gravity,!t.keys.space),n},fall:function(e,t){t=this.on.walk.call(this,e,t);var n=this.on.collision.call(this,e,t);return n.triggers.indexOf("bottom")>-1?(this.data.event.fall=!1,t=n.event,this.on.land.call(this,e,t)):(this.data.jumpRate=this.data.jumpForce,t.action="fall",this.data.event.fall=!0,this.data.y+=Math.floor(2*this.data.fallRate),this.data.fallRate+=e.world.data.gravity),t},land:function(e,t){return this.data.event.jump=!1,this.data.event.fall=!1,this.data.fallRate=0,this.data.jumpRate=this.data.jumpForce,t},crouch:function(e,t){},destroy:function(t,n){var r=null;this.data.oldFrame.animation!==""&&(r=this.animations[this.data.oldFrame.animation].frames[this.data.oldFrame.index]),this.data.direction.left===!0?(this.data.isFlipped||(n.context.save(),n.context.scale(-1,1),n.context.translate(-e.canvas.width,0),this.data.isFlipped=!0),r!==null&&n.context.clearRect(e.canvas.width-(this.data.oldFrame.x-r.cpx)-r.w-3,this.data.oldFrame.y-r.cpy-3,r.w+3,r.h+3)):(this.data.isFlipped&&(n.context.restore(),this.data.isFlipped=!1),r!==null&&n.context.clearRect(this.data.oldFrame.x-r.cpx-3,this.data.oldFrame.y-r.cpy-3,r.w+3,r.h+3))},animate:function(t,n){var r={action:"stand",move:!1};this.data.event.fall?r=this.on.fall.call(this,t,r):this.data.event.jump?r=this.on.jump.call(this,t,r):this.data.event.walk&&(r=this.on.walk.call(this,t,r)),this.animations[r.action].speed>0&&this.counter++;var i=this.animations[r.action].speed,s=this.counter,o=Math.floor(s/i);if(o>this.animations[r.action].frames.length-1||i===0)o=0,this.counter=0;var u=null;this.data.oldFrame.animation!==""&&(u=this.animations[this.data.oldFrame.animation].frames[this.data.oldFrame.index]);var a=this.data.frameData=this.animations[r.action].frames[o];this.data.direction.left===!0?(this.data.isFlipped||(n.context.save(),n.context.scale(-1,1),n.context.translate(-e.canvas.width,0),this.data.isFlipped=!0),n.context.drawImage(this.image,a.x,a.y,a.w,a.h,e.canvas.width-(this.data.x-a.cpx)-a.w,this.data.y-a.cpy,a.w,a.h)):n.context.drawImage(this.image,a.x,a.y,a.w,a.h,this.data.x-a.cpx,this.data.y-a.cpy,a.w,a.h),this.data.isFlipped&&(n.context.restore(),this.data.isFlipped=!1),this.data.oldFrame.index=o,this.data.oldFrame.animation=r.action,this.data.oldFrame.x=this.data.x,this.data.oldFrame.y=this.data.y},collision:function(t,r){var i={triggers:[],event:r},s=function(e){var t=Math.round(e/32)-1;return t<0&&(t=0),t},o=this.data.x,u=this.data.y,a=this.data.x+this.data.w,f=this.data.y+this.data.h,l=(o+a)/2,c=(u+f)/2,h=n.collide(s(o),s(c));if(o<=0||h.passable===!1)i.triggers.push("left"),i.event.action="stand",this.data.event.walk=!1,this.data.event.stand=!0;h=n.collide(s(a),s(c));if(a>=e.canvas.width||h.passable===!1)i.triggers.push("right"),i.event.action="stand",this.data.event.walk=!1,this.data.event.stand=!0;h=n.collide(s(l),s(u));if(u<=0||h.passable===!1)i.triggers.push("top"),this.data.event.jump&&(this.data.event.jump=!1,this.data.event.fall=!0,i.event.action="fall");h=n.collide(s(l),s(f));if(f>=e.canvas.height||h.passable===!1)i.triggers.push("bottom"),this.data.event.fall&&(this.data.event.jump=!1,this.data.event.fall=!1,i.event.action="land");return i}}}),define("/data/animations/block.js",[],function(){return{idle:{speed:0,frames:[{x:0,y:96,w:64,h:64,cpx:32,cpy:32}]}}}),define("/data/data/block.js",[],function(){return{health:100,x:448,y:96,tileX:14,tileY:3,w:64,h:64,id:"block",action:"idle",fallRate:0,passable:!1,frameData:null,onLand:!1,moveSpeed:1,direction:{right:!1,left:!1},event:{fall:!0,move:!1},blocked:{up:!1,down:!1,right:!1,left:!1},physics:{checkAgainst:["map"],types:["entity","block"]},event:{fall:!0}}}),define("/data/events/block.js",["animation","input","map"],function(e,t,n){return{animate:function(t,n){(this.data.event.fall||!this.data.onLand)&&this.on.fall.call(this,t,n),this.data.event.move&&this.on.move.call(this,t,n),e.context.drawImage(this.image,this.data.frameData.x,this.data.frameData.y,this.data.frameData.w,this.data.frameData.h,this.data.x-this.data.frameData.cpx,this.data.y-this.data.frameData.cpy,this.data.w,this.data.h),this.on.resetCollisions.call(this)},move:function(e,t){this.data.direction.right===!0&&this.data.blocked.right===!1?this.data.x=this.data.x+this.data.moveSpeed:this.data.direction.left===!0&&this.data.blocked.left===!1&&(this.data.x=this.data.x-this.data.moveSpeed)},fall:function(e,t){this.data.event.fall=!0,this.data.y+=Math.floor(2*this.data.fallRate),this.data.fallRate+=e.world.data.gravity},land:function(e,t){this.data.onLand=!0,this.data.event.fall=!1,this.data.fallRate=0},collideBottom:function(e){this.data.event.fall&&(this.data.y=e.y*32-32,this.on.land.call(this)),this.data.onLand=!0,this.data.blocked.down=!0},collideTop:function(e){this.data.blocked.up=!0},collideRight:function(e){this.data.event.move=!0,this.data.direction.left=!0,this.data.blocked.right=!0},collideLeft:function(e){this.data.event.move=!0,this.data.direction.right=!0,this.data.blocked.left=!0},parseTilePosition:function(){var e=function(e){var t=Math.round(e/32);return t},t=this.animations[this.data.action].speed,n=this.counter,r=Math.floor(n/t);if(r>this.animations[this.data.action].frames.length-1||t===0)r=0,this.counter=0;this.data.frameData=this.animations[this.data.action].frames[r],this.data.tileX=e(this.data.x-this.data.frameData.cpx),this.data.tileY=e(this.data.y-this.data.frameData.cpy)},resetCollisions:function(){this.data.action="idle",this.data.onLand=!1,this.data.direction.left=!1,this.data.direction.right=!1,this.data.blocked.left=!1,this.data.blocked.right=!1,this.data.blocked.up=!1,this.data.blocked.down=!1,this.data.isFlipped&&(e.context.restore(),this.data.isFlipped=!1),this.on.parseTilePosition.call(this)}}}),define("/data/master.js",["entity","/data/data/world.js","/data/animations/playertest.js","/data/data/player.js","/data/events/player.js","/data/animations/dummy.js","/data/data/dummy.js","/data/events/dummy.js","/data/animations/block.js","/data/data/block.js","/data/events/block.js"],function(e,t,n,r,i,s,o,u,a,f,l){var c={characters:{},tiles:{},objects:{},tools:{},environment:{}};return e.make(c,"/images/tiles.png","characters",a,f,l),e.make(c,"/images/playertest.png","characters",n,r,i),e.make(c,"/images/mmz.png","characters",s,o,u),e.make(c,null,"environment",null,t,null),c}),require(["animation","input","entity","map","/data/master.js"],function(e,t,n,r,i){t.listen("keydown",function(){t.keyDown(event,t)}),t.listen("keyup",function(){t.keyUp(event,t)}),r.buildMap("test"),n.spawn(i.characters.player,{},e.renderList),n.spawn(i.characters.block,{},e.renderList);var s=function(){return e.animationLoop.call(e,r,i),requestAnimationFrame(s)};e.mainLoop=s()}),define("main",function(){})