define(["physics","map"],function(e,t){return function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),{canvas:{},context:{},renderList:[],mainLoop:null,startLoop:function(e){return e()},stopLoop:function(e){cancelAnimationFrame(e)},setup:function(e){this.canvas=document.getElementById(e),this.context=this.canvas.getContext("2d"),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},animationLoop:function(t,n){var r=this.renderList.length,i;t.animate(this),this.setup("objects");for(var s=0;s<r;s++){var i=this.renderList[s];i.remove?(i.on.destroy.call(i,null,null),this.renderList.splice(s),r=this.renderList.length,s--):(e(i,this.renderList),i.data.id==="player"?(this.setup("player"),i.on.animate.call(i,n.environment,null),this.context.fillStyle="rgba(0,0,0,0.5)",this.context.fillRect(i.data.x-i.data.frameData.cpx,i.data.y-i.data.frameData.cpy,i.data.w,i.data.h),this.setup("objects")):(i.on.animate.call(i,n.environment,null),this.context.fillStyle="rgba(0,0,0,0.5)",this.context.fillRect(i.data.x-i.data.frameData.cpx,i.data.y-i.data.frameData.cpy,i.data.w,i.data.h)))}}}})